<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Find Off-Road Recovery Volunteers | FreeOffRoadRecovery</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f4f8f4;
      --card: #ffffff;
      --text: #1e2a1f;
      --muted: #55635a;
      --brand: #2d593f;
      --brand-dark: #234a34;
      --border: #e6eae6;
      --warn-bg: #fff8e1;
      --warn-border: #d6b700;
    }
    * { box-sizing: border-box; }
    body { margin:0; background:var(--bg); color:var(--text); font:16px/1.45 Arial, sans-serif; }
    main { max-width: 980px; margin: 24px auto; padding: 0 16px; }
    h1, h2 { color: var(--brand); margin: 0 0 10px; }
    label { display:block; font-weight:600; margin: 14px 0 6px; }
    select { width: 100%; max-width: 420px; padding: 10px; border: 1px solid var(--border); border-radius: 6px; background:#fff; }
    .row { display:flex; gap:16px; flex-wrap:wrap; }
    .results { margin-top: 16px; padding: 12px; background: var(--card); border-radius: 8px; box-shadow: 0 1px 4px rgba(0,0,0,0.08); }
    iframe { width: 100%; height: 760px; border: 0; border-radius: 8px; }
    .disclaimer-link { font-size: 0.95rem; margin: 10px 0; display: inline-block; color: #225533; cursor: pointer; text-decoration: underline; }
    .disclaimer-box { display: none; background-color: var(--warn-bg); border: 1px solid var(--warn-border); padding: 14px; margin: 8px 0 20px; border-radius: 6px; }
    small { color: #566; }
  </style>
</head>
<body>
  <main>
    <h1>Find Off-Road Recovery Volunteers</h1>

    <a class="disclaimer-link" onclick="toggleDisclaimer()">ðŸ“œ Read Disclaimer</a>
    <div id="disclaimerBox" class="disclaimer-box">
      <p><strong>DISCLAIMER:</strong> This directory is a public bulletin board connecting people in need of off-road recovery with volunteers. FreeOffRoadRecovery.org does not verify the identity, skill, or background of any volunteers listed. All volunteers operate independently. Both the person requesting recovery and the volunteer act at their own risk. If you are uncomfortable with this, do not proceed â€” instead contact a professional towing service or local authorities.</p>
      <button onclick="toggleDisclaimer()">Close</button>
    </div>

    <section>
      <h2>Search by State & City</h2>
      <div class="row">
        <div>
          <label for="stateSelect">Select State</label>
          <select id="stateSelect"></select>
        </div>
        <div>
          <label for="citySelect">Select City</label>
          <select id="citySelect"></select>
        </div>
      </div>
      <div id="stateCityResults" class="results"></div>
    </section>

    <section style="margin-top:28px;">
      <h2>View Volunteers on the Map</h2>
      <iframe src="YOUR_GOOGLE_MAP_EMBED_URL" allowfullscreen></iframe>
    </section>
  </main>

  <script>
    // 1) Replace with your Google Apps Script Web App URL (must end with /exec)
    const SCRIPT_URL = 'YOUR_APPS_SCRIPT_WEBAPP_URL';

    let rows = []; // full data cache

    // Initialize
    init();

    async function init() {
      setLoading(true);
      clearSelects();

      try {
        const res = await fetch(`${SCRIPT_URL}?mode=full`, { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const ct = res.headers.get('content-type') || '';
        if (!ct.includes('application/json')) throw new Error('Response was not JSON (check access/deploy URL)');

        rows = (await res.json()) || [];
        const valid = rows.filter(r => r && r.State && r.City);

        // Build State list
        const states = [...new Set(valid.map(r => String(r.State).trim()))].sort();
        const stateSelect = document.getElementById('stateSelect');
        stateSelect.innerHTML = `<option value="">--Select State--</option>` + states.map(s => `<option value="${escapeHtml(s)}">${escapeHtml(s)}</option>`).join('');
        stateSelect.onchange = onStateChange;

        const citySelect = document.getElementById('citySelect');
        citySelect.innerHTML = `<option value="">--Select City--</option>`;
        citySelect.onchange = onCityChange;

        document.getElementById('stateCityResults').innerHTML = `<em>Select a state, then a city.</em>`;
      } catch (err) {
        console.error(err);
        document.getElementById('stateCityResults').innerHTML =
          `<em>Couldnâ€™t load directory. Verify your Apps Script deployment URL and permissions.<br><small>${escapeHtml(String(err))}</small></em>`;
      } finally {
        setLoading(false);
      }
    }

    function onStateChange() {
      const state = document.getElementById('stateSelect').value;
      const citySelect = document.getElementById('citySelect');
      if (!state) {
        citySelect.innerHTML = `<option value="">--Select City--</option>`;
        document.getElementById('stateCityResults').innerHTML = `<em>Select a state, then a city.</em>`;
        return;
      }
      const cities = [...new Set(rows.filter(r => r.State === state).map(r => String(r.City).trim()))].sort();
      citySelect.innerHTML = `<option value="">--Select City--</option>` + cities.map(c => `<option value="${escapeHtml(c)}">${escapeHtml(c)}</option>`).join('');
      document.getElementById('stateCityResults').innerHTML = `<em>Select a city.</em>`;
    }

    function onCityChange() {
      const state = document.getElementById('stateSelect').value;
      const city = document.getElementById('citySelect').value;
      if (!state || !city) return;

      const filtered = rows.filter(r => r.State === state && r.City === city);
      const html = filtered.length
        ? filtered.map(r => {
            const name = r['Full Name'] || 'Name N/A';
            const phone = r['Phone'] || 'Phone N/A';
            const dist = r['Distance'] ? `<br><small>${r['Distance']} mi away</small>` : '';
            return `<div><strong>${escapeHtml(name)}</strong> â€” ${escapeHtml(phone)}${dist}</div>`;
          }).join('<br><br>')
        : `<em>No volunteers found for this city.</em>`;
      document.getElementById('stateCityResults').innerHTML = html;
    }

    function toggleDisclaimer() {
      const box = document.getElementById('disclaimerBox');
      const isHidden = getComputedStyle(box).display === 'none';
      box.style.display = isHidden ? 'block' : 'none';
    }

    function clearSelects() {
      document.getElementById('stateSelect').innerHTML = `<option value="">--Select State--</option>`;
      document.getElementById('citySelect').innerHTML = `<option value="">--Select City--</option>`;
    }

    function setLoading(on) {
      const target = document.getElementById('stateCityResults');
      if (on) target.innerHTML = `<em>Loading directoryâ€¦</em>`;
    }

    function escapeHtml(s) {
      return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m]));
    }
  </script>
</body>
</html>

